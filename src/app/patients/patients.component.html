<div class="container shadow-lg p-4 bg-light rounded">

    <h1 class="h2  mx-2">Liste des Patients</h1>
    <hr class="border border-primary mt-0 mb-3 ">
    <div class="alert alert-danger" role="alert" *ngIf="erreur">
        Erreur
    </div>
    <div class="alert alert-success" role="alert" *ngIf="succes">
        Opération effectuée avec succès!
    </div>
    <div class="mb-3 text-end">
        <button data-bs-toggle="modal" data-bs-target="#addPatientModal" class="btn btn-success"
            (click)="refreshList()">Nouveau
            patient</button>
        <button (click)="refreshList()" class="btn btn-primary ms-3">
            <fa-icon [icon]="faSync"></fa-icon>
        </button>
    </div>
    <div>

        <table class="table table-light table-striped align-middle">
            <thead class="table-dark">
                <tr>
                    <th> <span>#</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByIdAsc()"> &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByIdDesc()"> &darr;
                            </a></span>
                    </th>
                    <th> <span>Nom</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByNameAsc()"> &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByNameDesc()"> &darr;
                            </a></span>
                    </th>
                    <th>
                        <span>Prénom</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByPrenomAsc()">
                                &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByPrenomDesc()">
                                &darr;
                            </a></span>
                    </th>
                    <th>
                        <span>Mail</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByEmailAsc()"> &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByEmailDesc()">
                                &darr;
                            </a></span>
                    </th>
                    <th>
                        <span>Téléphone</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByTelephoneAsc()">
                                &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByTelephoneDesc()">
                                &darr;
                            </a></span>
                    </th>
                    <th>
                        <span>Ville</span>
                        <span class="btn-group ms-2" role="group" aria-label="Sorting">
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByVilleAsc()"> &uarr;
                            </a>
                            <a class="btn btn-outline-secondary border-0 btn-sm px-1" (click)="sortByVilleDesc()">
                                &darr;
                            </a></span>
                    </th>
                    <th>
                        <fa-icon [icon]="faCogs"></fa-icon>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let patient of patientsList">
                    <td>{{ patient.id }}</td>
                    <td> {{ patient.nom }} </td>
                    <td> {{ patient.prenom }} </td>
                    <td> {{ patient.email }} </td>
                    <td> {{ patient.telephone }} </td>
                    <td> {{ patient.ville?.nom }} </td>
                    <td> <button type="button" class="btn btn-warning edit_patient_button" data-bs-toggle="modal"
                            data-bs-target="#addPatientModal" (click)="editPatient(patient.id)">
                            <fa-icon [icon]=faEdit></fa-icon>
                        </button> &nbsp;
                        <button type="button" class="btn btn-danger delete_patient_button"
                            (click)="deletePatient(patient.id)">
                            <fa-icon [icon]="faTrash"></fa-icon>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>


    </div>

</div>

<!-- Modal -->
<div class="modal fade" id="addPatientModal" tabindex="-1" aria-labelledby="addPatientModal" aria-hidden="true">
    <div class="modal-dialog">
        <form name="patientAddForm" ngNativeValidate (submit)="submitForm()">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ajouter un patient</h5>
                    <button type="button" #closeModalButton class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text" id="addon-wrapping"><i class="fas fa-user-edit pe-2"></i>Prénom
                            et
                            Nom</span>
                        <input type="text" class="form-control" name="prenom" placeholder="Prénom"
                            [(ngModel)]="newPatient.prenom" ngModel required>
                        <input type="text" class="form-control" name="nom" placeholder="Nom"
                            [(ngModel)]="newPatient.nom" ngModel required>
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text" id="addon-wrapping"><i class="fas fa-at pe-2"></i>Email</span>
                        <input type="email" class="form-control" name="email" id="email" placeholder="Email"
                            [(ngModel)]="newPatient.email" ngModel required>
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text" id="addon-wrapping"><i
                                class="fas fa-phone-alt pe-2"></i>Téléphone</span>
                        <input type="tel" class="form-control" name="telephone" id="" placeholder="Téléphone"
                            [(ngModel)]="newPatient.telephone" ngModel required>
                    </div>
                    <div class="input-group flex-nowrap mb-3">
                        <span class="input-group-text" id="addon-wrapping"><i class="fas fa-city pe-2"></i>Ville</span>

                        <select class="form-select" name="ville" id="ville" [compareWith]="compareVilleFn"
                            [(ngModel)]="newPatient.ville" ngModel>
                            <option *ngFor="let ville of villesList" [ngValue]="ville">{{ ville.nom }}</option>

                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-secondary" id="valider_button">Valider</button>
                    <button type="reset" class="btn btn-danger float-end">Reset</button>
                </div>
            </div>
        </form>
    </div>
</div>